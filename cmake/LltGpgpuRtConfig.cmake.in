cmake_minimum_required(VERSION 3.13)

find_package(PkgConfig)
pkg_check_modules(_LIBDRM REQUIRED libdrm libdrm_intel)

set(LLT_GPGPU_RT_INCLUDE_DIRS "@LLT_GPGPU_RT_INSTALLED_PACKAGE_INCLUDE_DIRS@")
set(LLT_GPGPU_RT_INCLUDE_DIRS ${LLT_GPGPU_RT_INCLUDE_DIRS} ${_LIBDRM_INCLUDE_DIRS})

set(LLT_GPGPU_RT_LIBRARIES "@LLT_GPGPU_RT_INSTALLED_PACKAGE_LIBRARIES@")
set(LLT_GPGPU_RT_LIBRARIES ${LLT_GPGPU_RT_LIBRARIES} ${_LIBDRM_LIBRARIES})

# Find llt_gppgu_rt_i915_c
set(LLT_GPGPU_RT_PROGRAM_I915_C "@CMAKE_INSTALL_PREFIX@/bin/llt_gpgpu_rt_i915_c")

function(llt_gpgpu_compile_i915 CL_TARGET CL_SRC)
	add_custom_command(
		OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/${CL_TARGET}"
		COMMAND
			"${LLT_GPGPU_RT_PROGRAM_I915_C}" -cl-std=CL1.2
				-o "${CMAKE_CURRENT_BINARY_DIR}/${CL_TARGET}"
				"${CMAKE_CURRENT_SOURCE_DIR}/${CL_SRC}"
		DEPENDS
			"${CMAKE_CURRENT_SOURCE_DIR}/${CL_SRC}")
endfunction()

unset(_LIBDRM_FOUND)
unset(_LIBDRM_INCLUDE_DIRS)
unset(_LIBDRM_LIBRARIES)
